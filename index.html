<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>SwipeTree</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="style.css">
  <script>
    // Parse the starting ID from the URL early so the core can read it.
    (function(){
      var m = location.hash.match(/id=(\d+(?:\.\d+)*)/);
      if (m) window.__ST_START_ID = m[1];
    })();
  </script>
</head>
<body>
  <div id="stage">
    <button id="backBtn" hidden>Back</button>
    <img id="anchorImage" alt="" draggable="false">
    <div id="grid" hidden></div>
  </div>

  <script>
    (function(){
      function getId(){
        return (window.__ST_START_ID || (location.hash.match(/id=(\d+(?:\.\d+)*)/)||[])[1] || "140000");
      }

      function afterCoreLoad(){
        // Nudge cores that listen to hashchange
        setTimeout(function(){ window.dispatchEvent(new HashChangeEvent('hashchange')); }, 0);
        setTimeout(function(){ window.dispatchEvent(new HashChangeEvent('hashchange')); }, 120);

        // If nothing has rendered quickly, ensure the anchor is visible so testing can proceed.
        setTimeout(function(){
          var img = document.getElementById('anchorImage');
          if (img && !img.getAttribute('src')) {
            img.src = getId() + ".jpg";
            img.removeAttribute('hidden');
          }
        }, 180);
      }

      function loadCore(src, next){
        var s = document.createElement('script');
        s.src = src;
        s.defer = true;
        s.onload = afterCoreLoad;
        s.onerror = next;
        document.body.appendChild(s);
      }

      // Try v132, then fallback to script.js
      loadCore('script.v132.js', function(){ loadCore('script.js'); });
    })();
  </script>
</body>
</html>
